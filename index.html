// 1. BANCO DE DADOS COMPLETO COM IMAGENS E TRAILERS
const allMoviesDatabase = {
  marvel: [
    {
      title: "Thunderbolts",
      embedUrl: "https://www.youtube.com/embed/8OAZI6Q9Qj8",
      imageUrl: "img/thunderbolts.jpg",
      description: "Um grupo de anti-heróis e vilões se une em uma missão secreta.",
      releaseDate: "01/05/2025"
    },
    {
      title: "Quarteto Fantastico: Novos Passos",
      imageUrl: "img/quarteto-fantastico.jpg",
      description: "A primeira família dos quadrinhos chega ao MCU.",
      releaseDate: "25/07/2025"
    },
    {
      title: "Blade",
      embedUrl: "https://www.youtube.com/embed/8OAZI6Q9Qj8",
      imageUrl: "img/blade.jpg",
      description: "O caçador de vampiros retorna em um filme sombrio.",
      releaseDate: "07/11/2025"
    },
    {
      title: "Demolidor: Renascido",
      embedUrl: "https://www.youtube.com/embed/9KZyUQpihsE",
      imageUrl: "img/demolidor.jpg",
      description: "Charlie Cox retorna como o Demolidor.",
      releaseDate: "04/03/2025"
    }
  ],
  dc: [
    {
      title: "Superman: O Legado",
      imageUrl: "img/superman-legado.jpg",
      description: "Nova versão do Superman.",
      releaseDate: "11/07/2025"
    },
    {
      title: "Batman, parte 2",
      embedUrl: "https://www.youtube.com/embed/...",
      imageUrl: "img/batman-parte2.jpg",
      description: "Robert Pattinson retorna como Batman.",
      releaseDate: "03/10/2025"
    },
    {
      title: "Pacificador - Temporada 2",
      imageUrl: "img/pacificador.jpg",
      description: "Esquadrão militar com criaturas sobrenaturais.",
      releaseDate: "08/2025"
    }
  ]
};

// 2. FUNÇÃO PARA CRIAR ELEMENTO DE MÍDIA
function createMediaElement(movie) {
  if (movie.embedUrl) {
    return `<iframe src="${movie.embedUrl}" allowfullscreen></iframe>`;
  } else if (movie.imageUrl) {
    return `<img src="${movie.imageUrl}" alt="${movie.title}" class="movie-image">`;
  }
  return '<div class="no-media">Mídia não disponível</div>';
}

// 3. CLASSE MOVIE MANAGER (ATUALIZADA)
class MovieManager {
  constructor() {
    this.updateFrequency = 24 * 60 * 60 * 1000; // 24 horas
    this.init();
  }

  init() {
    this.renderMovies();
    this.setupAutoUpdate();
  }

  getUpcomingMovies() {
    const today = new Date();
    return {
      marvel: allMoviesDatabase.marvel.filter(m => this.isUpcoming(m.releaseDate, today)),
      dc: allMoviesDatabase.dc.filter(m => this.isUpcoming(m.releaseDate, today))
    };
  }

  isUpcoming(releaseDate, today) {
    const release = this.parseDate(releaseDate);
    return release > today;
  }

  parseDate(dateStr) {
    const [day, month, year] = dateStr.split('/').map(Number);
    return new Date(year, month - 1, day || 1);
  }

  renderMovies() {
    const { marvel, dc } = this.getUpcomingMovies();
    
    document.getElementById('marvel-movies').innerHTML = this.generateMovieCards(marvel);
    document.getElementById('dc-movies').innerHTML = this.generateMovieCards(dc);
    
    this.updateTimestamp();
  }

  generateMovieCards(movies) {
    return movies.map(movie => `
      <div class="movie-card">
        <h2>${movie.title}</h2>
        <div class="media-container">
          ${createMediaElement(movie)}
        </div>
        <p class="description">${movie.description}</p>
        <p class="release-date">Lançamento: ${movie.releaseDate}</p>
      </div>
    `).join('');
  }

  setupAutoUpdate() {
    setInterval(() => this.renderMovies(), this.updateFrequency);
  }

  updateTimestamp() {
    document.getElementById('update-time').textContent = new Date().toLocaleString();
  }
}

// 4. INICIALIZAÇÃO
document.addEventListener('DOMContentLoaded', () => new MovieManager());
